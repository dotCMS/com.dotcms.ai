<h2>This is dotAI!</h2>

<script>

    const getText = async (prompt, callback) => {
        document.getElementById("loader").style.display="block";
        document.getElementById("submit").disabled=true;
        document.getElementById("answer").value="";


        const response = await fetch('/api/v1/ai/summarize', {
            method: 'POST',
            headers: {
                //Authorization: `Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhcGk4ODI3MTZhYS1hZDNkLTRiN2MtYmZjMS02NTgyZDYzNjUxYWEiLCJ4bW9kIjoxNjQyMDA4NTc0MDAwLCJuYmYiOjE2NDIwMDg1NzQsImlzcyI6IjNjYjk5OWIzLWE4YmItNDhhNC1iMDUzLTA3YjBmYThiZTJmMCIsImV4cCI6MTk0OTU5MjU3NCwiaWF0IjoxNjQyMDA4NTc0LCJqdGkiOiIxMzlmMGFiNy0wNDcwLTQyMDktOTZmMi1kOGQzOTU3MTQ1ZTEifQ.4w4-u2y3keA1yjruxmwnX4a7u_Ohy7XOv-uwbMXVHzI`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                query: prompt,
                stream: true,
                searchLimit:50,
                threshold:.2
            }),
            });
            const reader = response.body?.pipeThrough(new TextDecoderStream()).getReader();

            document.getElementById("loader").style.display="none";
            document.getElementById("submit").disabled=false;

            if (!reader) return;
            // eslint-disable-next-line no-constant-condition
            while (true) {
            // eslint-disable-next-line no-await-in-loop
            const { value, done } = await reader.read();
            if (done) break;
            let dataDone = false;
            const arr = value.split('\n');
            arr.forEach((data) => {
                if (data.trim().length === 0) return; // ignore empty message
                if (data.startsWith(':')) return; // ignore sse comment message
                if (data === 'data: [DONE]') {
                dataDone = true;
                return;
                }

                const json = JSON.parse(data.substring(6));
                if(json.choices[0].delta.content==null) return;
                document.getElementById("answer").value += json.choices[0].delta.content;
            });
            if (dataDone) break;
        }
    };
</script>



<style>
    .loader {
    border: 8px solid #f3f3f3; /* Light grey */
    border-top: 8px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 2s linear infinite;
    }

    @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
    }
</style>


<h3>Ask dotCMS.com a question</h3>

<div style="padding:10px">
    <input type="text" name="question" id="question" style="width:800px;height:30px;" 
        value="how can I build a template" 
        placeholder="Ask me a dotCMS question"/> 
</div>
<div style="padding:10px;height:40px;width:800px;">
    <div class="loader" style="display:none;padding:10px;float:left" id="loader"></div>
    <div id="button" style="float:right">
        <input type="button" name="submit" id="submit" value="Submit" onclick="getText(document.getElementById('question').value)"/>
    </div>
</div>
<div style="padding:10px">
    <textarea name="answer" id="answer" style="width:800px;height:500px;"></textarea>
</div>
    


